<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Note</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
      background: repeating-linear-gradient(45deg, #ffe6e6, #ffe6e6 10px, #fff 10px, #fff 20px);
      font-family: 'Press Start 2P', cursive;
      color: #330000;
      padding: 2rem;
    }

    .container {
      background-color: rgba(255, 200, 200, 0.85);
      padding: 2rem;
      border: 4px solid #aa3333;
      border-radius: 8px;
      box-shadow: 0 0 10px #aa3333;
      max-width: 700px;
      margin: auto;
    }

    .card {
      background: #fff0f0;
      border: 2px solid #aa3333;
      padding: 1rem;
      margin-top: 1rem;
    }

    button, a {
      background-color: #ff6666;
      border: 2px solid #aa3333;
      color: #fff;
      text-decoration: none;
      font-size: 12px;
      font-family: 'Press Start 2P', cursive;
      padding: 10px 20px;
      cursor: pointer;
      display: inline-block;
      margin-top: 1rem;
    }

    button:hover, a:hover {
      background-color: #cc3333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Note ID: <%= id %></h1>
    <div class="card">
      <div><%- content %></div>
    </div>

    <a href="/">Create another note</a>
    <button id="reportBtn">Report Note</button>
  </div>

  <script>
    document.getElementById('reportBtn').addEventListener('click', () => {
    const pathParts = window.location.pathname.split('/');
    const noteId = pathParts[pathParts.length - 1];
    console.log(noteId)

    const formData = new URLSearchParams();
    formData.append('id', noteId);

    fetch('/report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: formData.toString()
    })
    .then(async (response) => {
    if (!response.ok) {
      const errorText = await response.text();
      if (response.status === 429) {
        alert('Too many reports! Please try again later.');
      } else {
        alert(`Error: ${errorText}`);
      }
      throw new Error(`HTTP error ${response.status}`);
    }
    return response.text();
    })
    .then(data => {
      alert('Report submitted successfully.');
    })
    .catch(err => {
      console.error('Error reporting note:', err);
    });
  });
  </script>

  <script src="/js/main.js"></script>
</body>
</html>
